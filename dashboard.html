<script>
	$(document).ready(function(){
		var projects = [];		
		var event;
		$("#calendar").fullCalendar({
			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,agendaWeek,agendaDay,listWeek'
			},
			weekends: false,
			nowIndicator: true,
			events: function(start, end, callback){
				$.ajax({
					url: 'http://localhost:8080/projects'
				}).then(function(projects){
					//console.log("AJAX CALL PERFORMED");
					for(var count = 0; count < projects.length; count++){
						event = {
							allDay: true,
							title: projects[count].description,
							start: projects[count].deadline,
							end: projects[count].deadline,
							textColor: 'black',
							backgroundColor: '#33ccff',
							id: projects[count].id
						};
						$("#calendar").fullCalendar('renderEvent', event);
					}
				});		
			},
			eventClick: function(event, jsEvent, view){
				
			}
		});
		
		$("#closeModal").click(function(){
			$("#popupNoteInput").val("");
		});
		$("#x").click(function(){
			$("#popupNoteInput").val("");
		});
		$("#clear").click(function(){
			$("#popupNoteInput").val("");
		});
		$("#addNoteBtn").click(function(){
			$("#popupNoteInput").val("");
		});
	});
</script>
<div id="bodyDiv">
	<div id="tabDiv">
		<ul class="nav nav-tabs">
			<li role="presentation" class="active"><a href="#/"><span class="glyphicon glyphicon-globe"></span> Dashboard</a></li>
			<li role="presentation"><a href="#/viewAllTeams"><span class="glyphicon glyphicon-list-alt"></span> View All Teams</a></li>
			<li role="presentation"><a href="#/viewAllProjects"><span class="glyphicon glyphicon-list"></span> View All Projects</a></li>
			<li role="presentation"><a href="#/viewAllMembers"><span class="glyphicon glyphicon-user"></span> View All Team Members</a></li>
		</ul>		
	</div>
	<div id="listContainer">
		<div class="table-responsive" id ="projectListDiv">
			<div class="mainDivsHeader">
				<h3>Projects That Need Attention</h3>				
			</div>
			<div class="tableDiv">
				<table class="table">
					<tr><th>Name</th><th>Deadline</th><th>Project Health</th><th>Priority</th><th>Actions</th></tr>
					<tr ng-repeat="project in ctrl.projects" ng-if="project.project_health < 100 && ctrl.today < project.deadline" ng-style="ctrl.changeColor(project.project_health)">
						<td>{{project.name}}</td>
						<td>{{project.deadline | date:'MMM dd, yyyy'}}</td>
						<td>
							<progress max="100" value="{{project.project_health}}" ng-style="{ctrl.changeColor(project.project_health)}"></progress>
							<label>{{project.project_health}}%</label>
						</td>
						<td>{{project.priority}}</td>
						<td>
							<div class="btn-group">
								<button class="btn btn-default" title="Update Project" ng-click="ctrl.openProjUpdModal(project.id)" data-toggle="modal" data-target="#updateProjModal"><span class="glyphicon glyphicon-pencil"></span></button>
								<button class="btn btn-info" title="Add a Comment" data-toggle="modal" data-target="#notes" ng-click="ctrl.passToNotes(project.id)"><span class="glyphicon glyphicon-comment"></span></button>
							</div>
						</td>
					</tr>
				</table>
			</div>
		</div>
		<div id="calendarDiv">
			<div id="calendar"></div>
		</div>
		<!-- Modal -->
		<div class="modal fade" id="notes" role="dialog" data-backdrop="static">
			<div class="modal-dialog">			
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" id="x">&times;</button>
						<h4 class="modal-title">Notes for Project: {{ctrl.projectObj.name}}</h4>
					</div>
					<div class="modal-body">
						<textarea class="form-control" id="popupNoteInput" rows="5"ng-model="ctrl.note"></textarea>
						<br>
							<div style="text-align:center">
							<button class="btn btn-info" id="addNoteBtn" ng-click="ctrl.addProjNote(ctrl.note, ctrl.projectObj.id)">Add Note</button>
							<button class="btn btn-info" id="clear">Clear</button>
						</div>
					</div>
					<div id="noteHistory" class="modal-footer" style="text-align:center">
						<div id="historyItem" style="text-align: left;border-bottom: 1px solid #e5e5e5" ng-repeat="note in ctrl.notes | orderBy:'':true track by (note.time_stamp + $index)">
							<p style="text-decoration: underline">{{note.time_stamp | date:'MMM dd, yyyy, h:mm a'}}</p>
							<p>{{note.message}}</p>
							<!-- <button class="btn btn-danger" ng-click="ctrl.deleteNote(note.id, ctrl.projectObj.id)"><span class="glyphicon glyphicon-trash"></span></button> -->
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal" id="closeModal">Close</button>
					</div>
				</div>				
			</div>
		</div>
		<!-- Modal -->
		<div class="modal fade" id="updateProjModal" role="dialog" data-backdrop="static">
			<div class="modal-dialog">			
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" id="x">&times;</button>
						<h4 class="modal-title">Update {{project.description}}</h4>
					</div>
					<div class="modal-body">
						<label>ID</label>
						&nbsp;<input id="project-id" size="3" disabled />
						<br>
						<label>Project Name</label>
						<input id="project-name" ng-model="ctrl.projectObj.name" class="form-control" type="text"></input>
						<label>Description</label>
						<textarea id="project-description" ng-model="ctrl.projectObj.description" class="form-control" rows="5"></textarea>
						<label>Priority</label>
						<select id="project-priority" ng-model="ctrl.projectObj.priority" class="form-control">
							<option value="">Choose a Priority</option>
							<option value=1>Low</option>
							<option value=2>Normal</option>
							<option value=3>High</option>
							<option value=4>Critical</option>
						</select>
						<label>Start Date</label>
						<div class="input-group">
							<span class="input-group-addon" id="basic-addon1">
								<span class="glyphicon glyphicon-calendar"></span>
							</span>
							<input type="date" min="" class="form-control" id="datepickerSD" placeholder="Select a date"></input>
						</div>
						<label>Deadline</label>
						<div class="input-group">
							<span class="input-group-addon" id="basic-addon1">
								<span class="glyphicon glyphicon-calendar"></span>
							</span>
							<input type="date" min="" class="form-control" id="datepickerD" placeholder="Select a date"></input>
						</div>
						<label>Status</label>
						<select id="project-status" ng-model="ctrl.projectObj.status" class="form-control">
							<option value="">Choose a Status</option>
							<option value=0>Inactive</option>
							<option value=1>Active</option>
							<option value=2>Completed</option>
						</select>
						<label>Phase</label>
						<select id="project-phase" ng-model="ctrl.projectObj.phase" class="form-control">
							<option value="">Choose a Phase</option>
							<option value="Planning and Analysis">Planning and Analysis</option>
							<option value="Requirements">Requirements</option>
							<option value="Development">Development</option>
							<option value="Testing and Validation">Testing and Validation</option>
							<option value="Integration">Integration</option>
							<option value="Production">Production</option>
						</select>
						<label>Work Remaining</label>
						<input id="project-work" ng-model="ctrl.projectObj.work_remaining" class="form-control" type="text"></input>
						<br>
						<button class="btn btn-default" ng-click="ctrl.updateProject()">Update Project</button>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal" id="closeModal">Close</button>
					</div>
				</div>				
			</div>
		</div>
	</div>
</div>